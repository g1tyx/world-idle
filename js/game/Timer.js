define([],function(){var t=function(t){this.ticksPerSecond=t.ticksPerSecond,this.ticksPerYear=t.secondsToGainOneYear*t.ticksPerSecond,this.year=t.year-1/this.ticksPerYear,this.maxExtraYears=t.maxExtraYears,this.extraYearModeOn=!1,this.secondsToGainOneYear=t.secondsToGainOneYear,this.secondsToGainOneExtraYear=t.secondsToGainOneExtraYear,this.extraYears=t.startingExtraYears,this.lastTickTimestamp=(new Date).getTime(),this.justLoaded=!0,this.chronometer=!1}
return t.prototype.setChronometer=function(t){t=t?!0:!1,this.chronometer!=t&&(this.chronometer=t,this.chronometer?this.secondsToGainOneYear=this.secondsToGainOneYear/3:this.secondsToGainOneYear=3*this.secondsToGainOneYear,this.ticksPerYear=this.secondsToGainOneYear*this.ticksPerSecond)},t.prototype.getChronometer=function(){return this.chronometer},t.prototype.getYear=function(){return this.year},t.prototype.getExtraYears=function(){return this.extraYears},t.prototype.setExtraYears=function(t){this.extraYears=t},t.prototype.addExtraYears=function(t){this.extraYears+=t},t.prototype.getIntervalMs=function(){return this.extraYearModeOn?1:Math.round(this.secondsToGainOneYear/this.ticksPerYear*1e3)},t.prototype.getTickMultiplayer=function(){return this.extraYearModeOn?1:1/this.ticksPerYear},t.prototype.wasNextYearTick=function(){return this.justLoaded?!0:Math.floor(this.year-this.getTickMultiplayer())!=Math.floor(this.year)},t.prototype.setLoaded=function(){this.justLoaded=!1},t.prototype.setExtraYearModeOn=function(t){this.extraYears>0&&(this.extraYearModeOn=t)},t.prototype.isExtraYearModeOn=function(){return this.extraYearModeOn},t.prototype.tick=function(){this.year+=this.getTickMultiplayer(),this.lastTickTimestamp=(new Date).getTime(),this.extraYearModeOn&&(this.extraYears--,this.extraYears<=0&&(this.extraYearModeOn=!1))},t.prototype.getSaveData=function(){return[this.year,this.extraYears,this.lastTickTimestamp]},t.prototype.updateFromSaveData=function(t,e){this.year=Number(t[0])
var r=(new Date).getTime(),a=0
e&&(a=(r-t[2])/1e3/this.secondsToGainOneExtraYear,10>a&&(a=0),a>this.maxExtraYears&&(a=this.maxExtraYears)),this.extraYears=Math.floor(Number(t[1])+a),this.lastTickTimestamp=r,this.justLoaded=!0},t})
